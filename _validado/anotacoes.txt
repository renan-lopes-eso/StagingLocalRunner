# 1 Formatar a maquina e instalar windows 11 pro e anti virus. Em opcoes de energia, desabilitar o sleep e a hibernacao

# 2 fixar o ip da maquina pelo unifi controller:
  1. Acesse o UniFi Controller
    - Web: https://unifi.ui.com ou IP do seu controller local
    - App: UniFi Network (mobile)
  2. Encontre a máquina de staging
    - Vá em Clients (lado esquerdo)
    - Procure pela máquina de staging (pelo nome do computador ou MAC)
  3. Criar a reserva
    - Clique na máquina
    - Clique em Settings (ícone de engrenagem) ou Configuration
    - Role até Network → Fixed IP Address ou Use Fixed IP Address
    - Ative e escolha um IP (ex: 192.168.1.100)
    - Clique em Apply ou Save

# 3 Configurar os segredos no github:
  1. Vá em: https://github.com/renan-lopes-eso/ESO.TestRunner/settings/environments
  2. Crie o ambiente staging caso ainda nao ouver e clique em staging
  3. Em enviroment secres, preencha os segredos, ex:
    - Name: ESO_CORE_CONNECTION
    - Value: Server=seu-mysql.com;Port=3306;Database=staging;Uid=user;Pwd=senha;
 
# 4 Criar GitHub Personal Access Token
  1. Acesse: https://github.com/settings/personal-access-tokens
  2. Clique em "Generate new token"
  3. Configure:
    - Token name: staging-runner-token
    - Expiration: escolha o período
    - Repository access: selecione "Only select repositories"
        - Escolha: renan-lopes-eso/StagingLocalRunner
  4. Em Permissions → Repository permissions:
    - Administration: Read and write (necessário para registrar runners)
    - Contents: Read-only
    - Metadata: Read-only (já vem marcado)
  5. Em Permissions → Organizations permissions:
    - Self-hosted runners: Read and write (necessário para registrar runners)
  6. Clique em "Generate token" e copie
  7. Atualize o C:\configs\secrets.json e teste:
    $token = "github_pat_..."
    $headers = @{ "Authorization" = "Bearer $token"; "Accept" = "application/vnd.github.v3+json" }
    Invoke-RestMethod -Uri "https://api.github.com/user" -Headers $headers

# 5 Secrets.json
  1. Crie o arquivo: c:/configs/secrets.json
  2. Preencha com o token do github e tambel com o final da url do repositorio:
    { "github": { "token":  "ghp_aa", "repo": "test" } }

# 6 Rodas os scripts de 1 a 3

# 7 Verificar runner:
    - https://github.com/renan-lopes-eso/ESO.TestRunner/settings/actions/runners
    - Deve aparecer "staging-local-runner" com status "Idle" (verde)

# 8 Fluxo de commits:
    - Dev desenvolve e da os commits na branch dev/feature-1
      - git checkout dev/feature-1
      - git add .
      - git commit -m "feature"
      - git push origin master
    - Quando aprovado, o dev mergeia o feature em uma branch do staging:
      - git checkout -b staging/feature-1
      - git merge master
      - git push origin staging/feature-1
    
    - git checkout -b staging/test
    - git commit --allow-empty -m "Test"
    - git push origin staging/test
    - Acompanhar em: https://github.com/renan-lopes-eso/ESO.TestRunner/actions
    - Container deve subir em: http://localhost:5001

troubleshoot:
para saber se o git runner esta rodando:
Get-Process -Name "Runner.Listener" -ErrorAction SilentlyContinue

  para mostrar erros internos da aplicacao:
  docker logs --tail 200 staging-staging-test

  Ver status do runner:
    Get-Process -Name Runner.Listener

  Ver logs do runner:
    Get-Content C:\configs\runner\_diag\*.log -Tail 50

  Iniciar runner manualmente:
    cd C:\configs\runner; .\run.cmd

  Parar runner:
    Stop-Process -Name Runner.Listener -Force

  Ver variaveis de ambiente do container:
    docker exec nome-do-container env


load-test.ps1.
  # Criar 5 cópias do container eso-core-staging-test
  .\load-test.ps1 -ContainerName "eso-core-staging-test" -Copies 5

  # Criar 10 cópias começando na porta 7000
  .\load-test.ps1 -ContainerName "eso-core-staging-test" -Copies 10 -StartPort 7000

  # Remover todos os containers de load test
  .\load-test.ps1 -ContainerName "eso-core-staging-test" -Copies 0 -Remove